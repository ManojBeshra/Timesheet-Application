{% extends "base.html" %}
{% load static %}
{% block title %}Ticket Details{% endblock title %}
{% block page-title %}Ticket Details{% endblock page-title %}
<!--style-->
{% block style %}
.small-btn {
    padding: 2px 8px; /* Adjust padding to reduce button size */
    font-size: 12px; /* Adjust font size */
    height: 35px; /* Set a specific height */
    width: auto; /* Adjust width as needed */
    line-height: 1; /* Adjust line height for better alignment */
} 

.view-small-btn   {
    padding: 2px 8px; /* Adjust padding to make it smaller */
    font-size: 12px; /* Reduce text size */
    height: 24px; /* Set height */
    line-height: 20px; /* Adjust line height for vertical alignment */
    width: auto; /* Allow width to adjust */
    display: inline-block; /* Ensures it behaves like a button */
    text-align: center; /* Center the text */
}

{% endblock style %}

{% block content %}


    <!-- ====================================
    ——— CONTENT WRAPPER
    ===================================== -->
    <div class="content-wrapper">
        <div class="content">
            <div class="card card-default">
                <div class="card-header">
                    <!--Ticket Details-->

                    <!--{% if user.is_staff %}readonly{% endif %}, {% if user.is_staff %}disabled{% endif %}-->
                    <form class="form-group col-12" method="POST" action="{% url 'taskdetails' ticket.id %}">
                        {% csrf_token %}
                        <div class="row">

                            <!-- Ticket Title -->
                            <div class="form-group col-12">
                                <label for="ticket_title">Title</label>
                                <input type="text" class="form-control" id="ticketname" name="ticket_title" 
                                       value="{{ ticket.ticket_title }}" {% if not request.user.is_staff %}readonly{% endif %} >
                            </div>
                    
                            <!-- Customer -->
                            <div class="form-group col-6">
                                <label for="customer">Customer</label>
                                <select class="form-control" id="customer" name="customer" {% if not request.user.is_staff %}disabled{% endif %}>
                                    {% for i in customers %}
                                    <option value="{{ i.id }}" {% if i.id == ticket.customer_id %}selected{% endif %}> 
                                        {{ i.name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                    
                            <!-- Priority -->
                            <div class="form-group col-6">
                                <label for="priority">Priority</label>
                                <select class="form-control" id="priority" name="priority" {% if not request.user.is_staff %}disabled{% endif %}>
                                    {% for i in priority_types %}
                                    <option value="{{ i.id }}" {% if i.id == ticket.priority_id %}selected{% endif %} >
                                        {{ i.priority_name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                    
                            <!-- Date Opened (Read-Only) -->
                            <div class="form-group col-4">
                                <label for="date_opened">Date Opened</label>
                                <input type="date" class="form-control" id="date_opened" name="date_opened"
                                       value="{{ ticket.date_opened|date:'Y-m-d' }}" readonly>
                            </div>
                    
                            <!-- Last Updated -->

                            <div class="form-group col-4">
                                <label for="last_updated_by">Last updated</label>
                                <input type="datetime" class="form-control" value="{{ ticket.last_updated }}" readonly>
                            </div>

                            <!-- Last Updated by -->

                            <div class="form-group col-4">
                                <label for="last_updated_by">Updated by</label>
                                <input type="text" class="form-control" value="{{ ticket.last_updated_by }}" readonly>
                            </div>
                            
                            <!-- Assigned To -->
                            <div class="form-group col-12">
                                <label for="assigned_to">Assigned To</label>
                                <select class="js-example-basic-multiple form-control" id="assigned_to" name="assigned_to" style="width: 100%; " multiple {% if not request.user.is_staff %}disabled{% endif %} >
                                    {% for i in users %}
                                    <option value="{{ i.id }}" {% if i in ticket.assigned_to.all %}selected{% endif %}>
                                        {{ i.username }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div> 


                            <!-- Short Description -->
                            <div class="form-group col-12">
                                <label for="short_description">Short Description</label>
                                <textarea class="form-control" id="short_description" name="short_description" rows="3"
                                {% if not request.user.is_staff %}readonly{% endif %}>{{ ticket.short_description }}</textarea>
                            </div>
                    
                            <!-- Solution -->
                            <div class="form-group col-12" {% if ticket.state.state_name != "Completed" %}hidden{% endif %}>
                                <label for="solution">Solution</label>
                                <textarea class="form-control" id="solution" name="solution" rows="4" >{{ ticket.solution }}</textarea>
                            <div class="form-group col-12">
                                <label for="solution">Operational Notes</label>
                                <textarea class="form-control" id="solution" name="solution" rows="4">{{ ticket.solution }}</textarea>
                            </div>
                    


                            <!-- Date Closed -->
                            <div class="form-group col-4">
                                <label for="date_opened">Date Closed</label>
                                <input {% if not request.user.is_staff %}readonly{% endif %} type="date" class="form-control" id="closed_date" name="closed_date"
                                        value="{{ ticket.closed_date }}" >
                            </div>


                            <!-- State -->
                            <div class="form-group col-6">
                                <label for="statelist">Status</label>
                                <select class="form-control" id="statelist" name="state" {% if not request.user.is_staff %}disabled{% endif %} >
                                    {% for i in states %}
                                    <option value="{{ i.id }}" {% if i.id == ticket.state_id %}selected{% endif %}>
                                        {{ i.state_name }}
                                    </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                    
                        <!-- Footer -->
                        <div class="modal-footer">
                            <button {% if not request.user.is_staff %}hidden{% endif %} type="submit" class="btn btn-outline-success small-btn">Save Changes</button>
                            <a href="{% url 'task' %}" class="btn btn-outline-danger small-btn d-flex justify-content-center align-items-center text-center">
                                Back
                            </a>
                        </div>
                    </form>
                    
                </div>
            </div>
        </div>
    </div>

    

{% endblock  %}


<script>

</script>