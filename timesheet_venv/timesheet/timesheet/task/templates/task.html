
{% extends "base.html" %}
{% load static %}
{% block title %}Task{% endblock title %}
{% block page-title %}Task{% endblock page-title %}
<!--style-->
{% block style %}
    #titlebg{
            width: auto; /* Ensures the button width adjusts based on content */
            display: inline-block; /* Ensures it behaves like an inline element with block-level properties */
            max-width: 100%; /* Allows the button to grow to fit its container */        
    }
{% endblock %}

{% block content %}

    <!-- ====================================
    ——— CONTENT WRAPPER
    ===================================== -->
    <div class="content-wrapper">
        <div class="content">
            <div class="card card-default">

                <!--Button Section-->
                <div class="card-header">

                     <!--Add Issue Buttons-->
                    <button type="button" class="btn btn-outline-success" data-toggle="modal" data-target="#exampleModalForm">
                        Add Issue
                    </button>

                     <!-- Form Modal -->
                    <div class="modal fade" id="exampleModalForm" tabindex="-1" role="dialog" aria-labelledby="exampleModalFormTitle"
                        aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="tickettitle">Add Ticket</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">×</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form class="row g-3">
                                        <!--Title-->
                                        <div class="form-group col-6">
                                            <label for="title">Title</label>
                                            <input type="text" class="form-control" id="title" aria-describedby="titleHelp" placeholder="Enter Title">
                                        </div>

                                        <!--customer-->
                                        <div class="form-group col-6">
                                            <label for="exampleFormControlSelect12">customer</label>
                                            <select class="form-control" id="customerlist" >
                                                {% for i in customers %}
                                                    <option value="{{ i.id }}" {% if i.id == ticket.customer_id %}selected{% endif %}>
                                                        {{ i.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <!--Short Description-->
                                        <div class="form-group col-12">
                                            <label for="exampleFormControlTextarea1">Short Description</label>
                                            <textarea class="form-control" id="shortdescriptionarea" rows="1"></textarea>
                                        </div>

                                        <!--Task Type-->
                                        <div class="form-group col-6">
                                            <label for="exampleFormControlSelect12">Task Type</label>
                                            <select class="form-control" id="tasktypelist">
                                                {% for i in tickettype %}
                                                    <option value="{{ i.id }}" {% if i.id == ticket.tickettype_id %}selected{% endif %}>
                                                        {{ i.name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <!--Date Opened-->
                                        <div class="form-group col-6">
                                            <label for="date">Date Opened</label>
                                            <input type="date" class="form-control" id="date" aria-describedby="dateHelp" min="" max="">
                                        </div>
               
                                        <!--Assigned User-->
                                        <div class="form-group col-6">
                                            <label for="exampleFormControlSelect12">Assigned User</label>
                                            <select class="form-control" id="assigneduserlist">
                                                {% for i in users %}
                                                    <option value="{{ i.id }}" {% if i.id == ticket.assigned_to_id %}selected{% endif %}>
                                                        {{ i.username }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <!--Priority-->
                                        <div class="form-group col-6">
                                            <label for="exampleFormControlSelect12">Priority</label>
                                            <select class="form-control" id="prioritylist">
                                                {% for i in priority %}
                                                    <option value="{{ i.id }}" {% if i.id == ticket.priority_id %}selected{% endif %}>
                                                        {{ i.priority_name }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>

                                        <!--Comments-->
                                        <div class="form-group col-12">
                                            <label for="exampleFormControlTextarea1">Comments</label>
                                            <textarea class="form-control" id="commentsarea" rows="2"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <!--footer-->
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                                    <button type="button" id = "addTaskButton" class="btn btn-success ">Add</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!--Dropdown Filters-->
                    <div class="btn-group " role="group" aria-label="Basic example">
                        <button type="button" class="btn btn-outline-danger dropdown-toggle" id="userbtnGroupDrop" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            User
                        </button>
                        <div class="dropdown-menu" aria-labelledby="userbtnGroupDrop">
                            <a class="dropdown-item" href="{% url 'task' %}">Show all</a>
                            {% for i in users %}
                                <a class="dropdown-item" href="{% url 'filterTaskByUser' i.id %}">
                                    {{ i.username }}
                                </a>
                            {% endfor %}
                            
                        </div>
                    </div>

                </div>
                 
                <!--Issue Section-->
                <div class="card-body">
                    <div class="row">
                        <!-- New -->
                        <div class="col-lg-6 col-xl-3">
                            <div class="card mb-4 p-0 border-primary">
                                <a class="btn btn-primary" id="new">New</a>
                                
                                <div class="card-body p-4" ondrop="drop(event)" ondragover="allowDrop(event)" style="height: 350px; overflow-y: auto;">
                                    {%for i in ticketlist %}
                                    <div class="card shadow-lg pl-2 mt-2 ml-2 mr-2" id="{{i}}" draggable="true" ondragstart="drag(event)">
                                        <p class="card-text pb-1 pt-1 pr-2">
                                            <a class="btn" id="titlebg" style=" padding: 2px 5px; font-size: 0.75rem; max-width: 100%;">{{i.ticket_type}}</a>
                                        </p>
                                        <p class="card-text pb-1">
                                            {{ i.ticket_name }}
                                        </p>
                                        
                                        <a  href="{% url 'taskdetails' i.id %}" class="btn btn-info btn-sm position-absolute" style="bottom: 5px; right: 5px; padding: 2px 5px; font-size: 0.75rem;" style="color: inherit; text-decoration: none;">View </a>
                                        <!--fetch the priority value here-->
                                        <div id="priorityvalue" style="visibility: hidden;">High</div> 
                                    </div>
                                {%endfor%}
                                </div>
                                
                            </div>
                        </div>
               
                        <!-- In Progress -->
                        <div class="col-lg-6 col-xl-3">
                            <div class="card mb-4 p-0 border-info">
                                <a class="btn btn-info">In Progress</a>
                                <div class="card-body p-4" ondrop="drop(event)" ondragover="allowDrop(event)" style="height: 350px; overflow-y: auto;">
                                    <!-- {%for i in ticketlist %}
                                    <div class="card shadow-lg pl-2 mt-2 ml-2 mr-2" id="{{i}}" draggable="true" ondragstart="drag(event)">
                                        <p class="card-text pb-1 pt-1 pr-2">
                                            <a class="btn" id="titlebg" style=" padding: 2px 5px; font-size: 0.75rem; max-width: 100%;">{{i.ticket_type}}</a>
                                        </p>
                                        <p class="card-text pb-1">
                                            {{ i.ticket_name }}
                                        </p>
                                        
                                        <a  href="{% url 'taskdetails' i.id %}" class="btn btn-info btn-sm position-absolute" style="bottom: 5px; right: 5px; padding: 2px 5px; font-size: 0.75rem;" style="color: inherit; text-decoration: none;">View </a>
                                       
                                        <div id="priorityvalue" style="visibility: hidden;">High</div> 
                                    </div>
                                {%endfor%} -->
                                </div>
                            </div>
                        </div>
               
                        <!-- Hold -->
                        <div class="col-lg-6 col-xl-3">
                            <div class="card mb-4 p-0 border-warning">
                                <a class="btn btn-warning text-white">Hold</a>
                                <div class="card-body p-4" ondrop="drop(event)" ondragover="allowDrop(event)" style="height: 350px; overflow-y: auto;">
                                    <!-- {%for i in ticketlist %}
                                    <div class="card shadow-lg pl-2 mt-2 ml-2 mr-2" id="{{i}}" draggable="true" ondragstart="drag(event)">
                                        <p class="card-text pb-1 pt-1 pr-2">
                                            <a class="btn" id="titlebg" style=" padding: 2px 5px; font-size: 0.75rem; max-width: 100%;">{{i.ticket_type}}</a>
                                        </p>
                                        <p class="card-text pb-1">
                                            {{ i.ticket_name }}
                                        </p>
                                        
                                        <a  href="{% url 'taskdetails' i.id %}" class="btn btn-info btn-sm position-absolute" style="bottom: 5px; right: 5px; padding: 2px 5px; font-size: 0.75rem;" style="color: inherit; text-decoration: none;">View </a>
 
                                        <div id="priorityvalue" style="visibility: hidden;">High</div> 
                                    </div>
                                {%endfor%} -->
                                </div>
                            </div>
                        </div>
               
                        <!-- Completed -->
                        <div class="col-lg-6 col-xl-3">
                            <div class="card mb-4 p-0 border-success">
                                <a class="btn btn-success">Completed</a>
                                <div class="card-body p-4" ondrop="drop(event)" ondragover="allowDrop(event)" style="height: 350px; overflow-y: auto;">
                                    <!-- {%for i in ticketlist %}
                                    <div class="card shadow-lg pl-2 mt-2 ml-2 mr-2" id="{{i}}" draggable="true" ondragstart="drag(event)">
                                        <p class="card-text pb-1 pt-1 pr-2">
                                            <a class="btn" id="titlebg" style=" padding: 2px 5px; font-size: 0.75rem; max-width: 100%;">{{i.ticket_type}}</a>
                                        </p>
                                        <p class="card-text pb-1">
                                            {{ i.ticket_name }}
                                        </p>
                                        
                                        <a  href="{% url 'taskdetails' i.id %}" class="btn btn-info btn-sm position-absolute" style="bottom: 5px; right: 5px; padding: 2px 5px; font-size: 0.75rem;" style="color: inherit; text-decoration: none;">View </a>

                                        <div id="priorityvalue" style="visibility: hidden;">High</div> 
                                    </div>
                                {%endfor%} -->
                                </div>
                            </div>
                        </div>
               
                        <!-- Canceled -->
                        <div class="col-lg-6 col-xl-3">
                            <div class="card mb-4 p-0 border-danger">
                                <a class="btn btn-danger">Canceled</a>
                                <div class="card-body p-4" ondrop="drop(event)" ondragover="allowDrop(event)" style="height: 350px; overflow-y: auto;">
                                    <!-- {%for i in ticketlist %}
                                    <div class="card shadow-lg pl-2 mt-2 ml-2 mr-2" id="{{i}}" draggable="true" ondragstart="drag(event)">
                                        <p class="card-text pb-1 pt-1 pr-2">
                                            <a class="btn" id="titlebg" style=" padding: 2px 5px; font-size: 0.75rem; max-width: 100%;">{{i.ticket_type}}</a>
                                        </p>
                                        <p class="card-text pb-1">
                                            {{ i.ticket_name }}
                                        </p>
                                        
                                        <a  href="{% url 'taskdetails' i.id %}" class="btn btn-info btn-sm position-absolute" style="bottom: 5px; right: 5px; padding: 2px 5px; font-size: 0.75rem;" style="color: inherit; text-decoration: none;">View </a>

                                        <div id="priorityvalue" style="visibility: hidden;">High</div> 
                                    </div>
                                {%endfor%} -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
   
    <!--for drag/drop card-->
    <script>
        function allowDrop(ev) {
          ev.preventDefault();
        }
       
        function drag(ev) {
          ev.dataTransfer.setData("text", ev.target.id);
        }
       
        function drop(ev) {
          ev.preventDefault();
          const data = ev.dataTransfer.getData("text");
          const draggedElement = document.getElementById(data);
          const target = ev.target.closest('.card-body');
          if (target && draggedElement) {
            target.appendChild(draggedElement);
          }
        }
        
        
        
    </script>

    <script> 
        document.getElementById("addTaskButton").addEventListener("click", function () {
            // Capture form data
            const title = document.getElementById("title").value;
            const assigned_user = document.getElementById("assigneduserlist").value;
            const priority = document.getElementById("prioritylist").value;
            const ticket_type = document.getElementById("tasktypelist").value;
            const customer = document.getElementById("customerlist").value;
            const short_description = document.getElementById("shortdescriptionarea").value;
            const comments = document.getElementById("commentsarea").value;
        
           
            
        
        
            data={
                title: title,
                customerlist: customer,
                shortdescriptionarea: short_description,
                tickettypelist : ticket_type,
                assigneduserlist : assigned_user,
                prioritylist : priority,
                commentsarea : comments
            }

        $.ajax(
            {
                method:"POST",
                url: "{% url 'add_task' %}",
                //left side --> views.py
             data : data, 
                success: function( data ) 
                {
                    // Reset form and close modal
                    document.querySelector("form").reset();
                    $('#exampleModalForm').modal('hide');
                    location.reload();
                }
        }) ;

            
        });
    </script>
    <!--for Date Opened of Modal-->
    <script>
        // Get the current date
        const currentDate = new Date().toISOString().split('T')[0];
        // Set the min and max values to the current date
        const dateInput = document.getElementById('date');
        dateInput.value = currentDate;
        dateInput.setAttribute('min', currentDate);  // Disable past dates
        dateInput.setAttribute('max', currentDate);  // Disable future dates
    </script>

    <!--To Change the bg color of title based on Priority-->
    <script>
        // Function to dynamically change the background color
        {% comment %} function updatePriorityColor() {
            const priorityValue = document.getElementById('priorityvalue').textContent.trim();
            const titlebg = document.getElementById('titlebg');
            
            if (priorityValue === 'High') {
                titlebg.style.backgroundColor = 'red';
            } else if (priorityValue === 'Medium') {
                titlebg.style.backgroundColor = '#FFBF00';
            } else if (priorityValue === 'Low') {
                titlebg.style.backgroundColor = 'green';
            }
        } {% endcomment %}
    
        // Call the function to update the background color
        updatePriorityColor();
    </script>

{% endblock  %}
 












