{% extends "base.html" %}
{% load static %}
{% block title %}Worklog Details{% endblock title %}
{% block page-title %}Worklog Details{% endblock page-title %}

{% block style %}
    .small-btn {
        padding: 2px 8px;
        font-size: 12px;
        height: 35px;
        width: auto;
        line-height: 1;
    } 

    .view-small-btn   {
        padding: 2px 8px; /* Adjust padding to make it smaller */
        font-size: 12px; /* Reduce text size */
        height: 24px; /* Set height */
        line-height: 20px; /* Adjust line height for vertical alignment */
        width: auto; /* Allow width to adjust */
        display: inline-block; /* Ensures it behaves like a button */
        text-align: center; /* Center the text */
    }
{% endblock style %}

{% block content %}

        <div class="card card-default m-2">
            <div class="card-header">
                <div class = "container row">
                    <div class="form-group col-2">
                        <label for="date">Date</label>
                        <input type="date" class="form-control" id="date" name="date" value="{{ worklog.date|date:'Y-m-d' }}" readonly>
                    </div>

                    <div class="form-group col-2">
                        <label for="week">Week</label>
                        <input type="text" class="form-control" id="week" name="week" value="{{ worklog.week }}" readonly>
                    </div>
                    
                    <div class="form-group col-4">
                        <label for="exampleFormControlSelect12">Project/Support</label>
                
                        <input type="text" class="form-control" id="projects" name="project_support" value="{{ worklog.ticket.ticket_type.name }}" readonly>

                    </div>
                </div>
                
                <form class="form-group col-12" method="POST" action="{% url 'worklogdetails' worklog.id %}">
                    {% csrf_token %}
                    <div class = "container row">

                        
                        
                         <div class="form-group col-12">
                            <label for="workdone">Work Done</label>
                            <textarea class="form-control" id="workdone" name="workdone" rows="2">{{ worklog.workdone }}</textarea>
                            {% comment %} <input type="textarea" class="form-control" id="workdone" name="workdone" aria-describedby="titleHelp" rows="2" placeholder="Enter Work Done"> {% endcomment %}
                        </div>

                    </div>
                       
                    <div class = "container row">

                        <!-- Ticket -->
                        <div class="form-group col-4">
                            <label for="ticket">Ticket</label>
                            <select class="form-control" id="ticket" name="ticket" required>
                                {% for i in tickets %}
                                    <option value="{{ i.id }}" {% if i.id == worklog.ticket_id %}selected{% endif %}>{{ i.ticket_title }}</option>
                                {% endfor %}
                            </select>
                        </div>

                       
                        <div class="form-group col-4">
                            <label for="exampleFormControlSelect12">Category</label>
                            <input type="text" class="form-control" id="category" name="category" value="{{ worklog.category }}" >
                        </div>
                   
                        <!-- Hours -->
                        <div class="form-group col-2">
                            <label for="hours">Hours</label>
                            <input type="text" class="form-control" id="hours" name="hours" aria-describedby="titleHelp" placeholder="Enter hours" value = "{{worklog.hours}}">
                        </div>
                         <!-- Billable -->
                        <div class="form-group col-2">
                            <div class="custom-control custom-checkbox d-inline-block mt-7 mb-3">
                                <input type="checkbox" class="custom-control-input" id="customCheck2" name="billable"{% if worklog.billable %} checked {% endif %}/>

                                <label class="custom-control-label" for="customCheck2"></label>
                              </div>
                              <label for="billable">Billable</label>
                        </div> 

                        
                    

                    </div>
                    
                    <div class = "container row">

                        <!--Notes-->
                        <div class="form-group col-12">
                            <label for="exampleFormControlTextarea1">Comments</label>
                            <textarea class="form-control" id="shortdescriptionarea" name= "note" rows="2" >{{ worklog.note }}</textarea>
                        </div>

                        <!-- Notes -->
                        {% comment %} <div class="form-group col-12">
                            <label for="notes">Notes</label>
                            <textarea class="form-control" id="notes" name="notes" rows="3">{{ worklog.notes }}</textarea>
                        </div> {% endcomment %}
                        
                    </div>

                    <!-- Footer -->
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-outline-success small-btn">Save Changes</button>
                        <a href="{% url 'worklog' %}" class="btn btn-outline-danger small-btn d-flex justify-content-center align-items-center text-center">
                            Back
                        </a>
                    </div>
                </form>
            </div>
        </div>


        <script>
            function getWeekOfMonth(date) {
                let firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1); // 1st day of the month
                let firstDayWeekday = firstDayOfMonth.getDay(); // Day of the week (0 = Sunday, 1 = Monday, etc.)
                let dayOfMonth = date.getDate(); // Current day in the month
        
                // Calculate the week number of the month
                return Math.ceil((dayOfMonth + firstDayWeekday) / 7);
            }
        
            function setWeek() {
                let today = new Date();
                let weekNumber = getWeekOfMonth(today);
                document.getElementById("week").value = "Week " + weekNumber; // Set formatted week number
            }
        
            // Run function when page loads
            window.onload = setWeek;
        </script>
    
{% endblock %}
